open import Data.Vec
open import Data.Product renaming (_,_ to âŸ¨_,_âŸ©)

module Logic.Adjoint (Atom : Set) where

  open import Logic.Core.Props Atom public
  open import Logic.Core.Modes public
  open import Logic.Core.Contexts Atom public

  data _âŠ¢â±_ : Context n â†’ (Prop Ã— Mode) â†’ Set where

    id : update Î” âŸ¨ A , m âŸ© âŸ¨ A , Irrelevant âŸ© Î”' â†’ cWeakenable Î”'
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A , m âŸ©

    cut : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ Î”â‚ â‰¥á¶œ m â†’ Î”â‚‚ â‰¥á¶œ m â†’ m â‰¥ k
      â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ©
      â†’ (âŸ¨ A , m âŸ© âˆ· Î”â‚‚â‚ƒ) âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ•Râ‚ : Î” âŠ¢â± âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ• B , m âŸ©

    âŠ•Râ‚‚ : Î” âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ• B , m âŸ©

    âŠ•L : mayConsume Î” âŸ¨ A âŠ• B , m âŸ© Î”'
      â†’  (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , k âŸ© â†’ (âŸ¨ B , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    &R : Î” âŠ¢â± âŸ¨ A , m âŸ© â†’ Î” âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A & B , m âŸ©

    &Lâ‚ : mayConsume Î” âŸ¨ A & B , m âŸ© Î”'
      â†’  (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    &Lâ‚‚ : mayConsume Î” âŸ¨ A & B , m âŸ© Î”'
      â†’  (âŸ¨ B , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ—R : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ© â†’ Î”â‚‚â‚ƒ âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ— B , m âŸ©

    âŠ—L : mayConsume Î” âŸ¨ A âŠ— B , m âŸ© Î”'
      â†’ (âŸ¨ B , m âŸ© âˆ· âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ¸R : (âŸ¨ A , m âŸ© âˆ· Î”) âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ¸ B , m âŸ©

    âŠ¸L : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ mayConsume Î”â‚â‚‚ âŸ¨ A âŠ¸ B , m âŸ© Î”â‚â‚‚'
      â†’ mayConsume Î”â‚‚â‚ƒ âŸ¨ A âŠ¸ B , m âŸ© Î”â‚‚â‚ƒ'
      â†’ Î”â‚ â‰¥á¶œ m â†’ Î”â‚‚ â‰¥á¶œ m â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ©
      â†’ (âŸ¨ B , m âŸ© âˆ· Î”â‚‚â‚ƒ) âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    ğŸ™R : cWeakenable Î”
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ ğŸ™ , m âŸ©

    ğŸ™L : mayConsume Î” âŸ¨ ğŸ™ , m âŸ© Î”' â†’ Î”' âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    â†“R : merge Î”â‚ Î”â‚‚ Î”
      â†’ Î”â‚ â‰¥á¶œ m 
      â†’ cWeakenable Î”â‚‚
      â†’ Î”â‚ âŠ¢â± âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ â†“[ m ][ k ] A , k âŸ©

    â†“L : mayConsume Î” âŸ¨ â†“[ m ][ k ] A , m âŸ© Î”'
      â†’ (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , l âŸ©

    â†‘R : Î” âŠ¢â± âŸ¨ A , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ â†‘[ m ][ k ] A , k âŸ©

    â†‘L : mayConsume Î” âŸ¨ â†‘[ k ][ m ] A , k âŸ© Î”' â†’ k â‰¥ l
      â†’ (âŸ¨ A , k âŸ© âˆ· Î”') âŠ¢â± âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , l âŸ©

  data _âŠ¢áµ‰_ : Context n â†’ (Prop Ã— Mode) â†’ Set where

    id : update Î” âŸ¨ A , m âŸ© âŸ¨ A , Irrelevant âŸ© Î”' â†’ exh Î”'
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A , m âŸ©

    cut : merge Î”â‚ Î”â‚‚ Î”
      â†’ Î”â‚ â‰¥á¶œ m â†’ m â‰¥ k
      â†’ Î”â‚ âŠ¢áµ‰ âŸ¨ A , m âŸ©
      â†’ (âŸ¨ A , m âŸ© âˆ· Î”â‚‚) âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    weak : update Î” âŸ¨ A , m âŸ© âŸ¨ A , Irrelevant âŸ© Î”'
      â†’ mWeakenable m â†’ Î”' âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    contr : update Î” âŸ¨ A , m âŸ© âŸ¨ A , m âŸ© Î”
      â†’ mContractable m â†’ (âŸ¨ A , m âŸ© âˆ· Î”) âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    âŠ•Râ‚ : Î” âŠ¢áµ‰ âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A âŠ• B , m âŸ©

    âŠ•Râ‚‚ : Î” âŠ¢áµ‰ âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A âŠ• B , m âŸ©

    âŠ•L : update Î” (âŸ¨ A âŠ• B , m âŸ©) (âŸ¨ A âŠ• B , Irrelevant âŸ©) Î”'
      â†’  (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , k âŸ© â†’ (âŸ¨ B , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    &R : Î” âŠ¢áµ‰ âŸ¨ A , m âŸ© â†’ Î” âŠ¢áµ‰ âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A & B , m âŸ©

    &Lâ‚ : update Î” âŸ¨ A & B , m âŸ© âŸ¨ A & B , Irrelevant âŸ© Î”'
      â†’  (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    &Lâ‚‚ : update Î” âŸ¨ A & B , m âŸ© âŸ¨ A & B , Irrelevant âŸ© Î”'
      â†’  (âŸ¨ B , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    âŠ—R : merge Î”â‚ Î”â‚‚ Î”
      â†’ Î”â‚ âŠ¢áµ‰ âŸ¨ A , m âŸ© â†’ Î”â‚‚ âŠ¢áµ‰ âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A âŠ— B , m âŸ©

    âŠ—L : update Î” âŸ¨ A âŠ— B , m âŸ© âŸ¨ A âŠ— B , Irrelevant âŸ© Î”'
      â†’ (âŸ¨ B , m âŸ© âˆ· âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    âŠ¸R : (âŸ¨ A , m âŸ© âˆ· Î”) âŠ¢áµ‰ âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ A âŠ¸ B , m âŸ©

    âŠ¸L : merge Î”â‚ Î”â‚‚ Î”'
      â†’ update Î” âŸ¨ A âŠ¸ B , m âŸ© âŸ¨ A âŠ¸ B , Irrelevant âŸ© Î”'
      â†’ Î”â‚ â‰¥á¶œ m â†’ Î”â‚ âŠ¢áµ‰ âŸ¨ A , m âŸ©
      â†’ (âŸ¨ B , m âŸ© âˆ· Î”â‚‚) âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    ğŸ™R : cWeakenable Î”
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ ğŸ™ , m âŸ©

    ğŸ™L : update Î” âŸ¨ ğŸ™ , m âŸ© âŸ¨ ğŸ™ , Irrelevant âŸ© Î”' â†’ Î”' âŠ¢áµ‰ âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , k âŸ©

    â†“R : Î” â‰¥á¶œ m â†’ Î” âŠ¢áµ‰ âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ â†“[ m ][ k ] A , m âŸ©

    â†“L : update Î” âŸ¨ â†“[ m ][ k ] A , m âŸ© âŸ¨ â†“[ m ][ k ] A , Irrelevant âŸ© Î”'
      â†’ (âŸ¨ A , m âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , l âŸ©

    â†‘R : Î” âŠ¢áµ‰ âŸ¨ A , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ â†‘[ m ][ k ] A , k âŸ©

    â†‘L : update Î” âŸ¨ â†‘[ k ][ m ] A , k âŸ© âŸ¨ â†‘[ k ][ m ] A , Irrelevant âŸ© Î”'
      â†’ k â‰¥ l â†’ (âŸ¨ A , k âŸ© âˆ· Î”') âŠ¢áµ‰ âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢áµ‰ âŸ¨ C , l âŸ© 