open import Data.Vec
open import Data.Product renaming (_,_ to âŸ¨_,_âŸ©)

open import Logic.Core.Props
open import Logic.Core.Terms

module Logic.Adjoint (Atom : Set) (T : Set) (subst : Prop (Atom) â†’ Term (T) â†’ Prop (Atom))  where

  open import Logic.Core.Modes public
  open import Logic.Core.Contexts Atom T public

  data _âŠ¢â±_ : Context y n â†’ (Prop (Atom) Ã— Mode) â†’ Set where

    id : update Î” âŸ¨ A , m âŸ© âŸ¨ A , Irrelevant âŸ© Î”' â†’ cWeakenable Î”'
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A , m âŸ©

    cut : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ Î”â‚ â‰¥á¶œ m â†’ Î”â‚‚ â‰¥á¶œ m â†’ m â‰¥ k
      â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ©
      â†’ âŸ¨ projâ‚ Î”â‚‚â‚ƒ , (âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”â‚‚â‚ƒ) âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ•Râ‚ : Î” âŠ¢â± âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ• B , m âŸ©

    âŠ•Râ‚‚ : Î” âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ• B , m âŸ©

    âŠ•L : mayConsume Î” âŸ¨ A âŠ• B , m âŸ© Î”'
      â†’  âŸ¨ projâ‚ Î”' , ( âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , k âŸ©  â†’   âŸ¨ projâ‚ Î”' , âŸ¨ B , m âŸ© âˆ· projâ‚‚ Î”' âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    &R : Î” âŠ¢â± âŸ¨ A , m âŸ© â†’ Î” âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A & B , m âŸ©

    &Lâ‚ : mayConsume Î” âŸ¨ A & B , m âŸ© Î”'
      â†’  âŸ¨ projâ‚ Î”' , (âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    &Lâ‚‚ : mayConsume Î” âŸ¨ A & B , m âŸ© Î”'
      â†’  âŸ¨ projâ‚ Î”' , (âŸ¨ B , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ—R : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ© â†’ Î”â‚‚â‚ƒ âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ— B , m âŸ©

    âŠ—L : mayConsume Î” âŸ¨ A âŠ— B , m âŸ© Î”'
      â†’ âŸ¨ projâ‚ Î”' , (âŸ¨ B , m âŸ© âˆ· âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    âŠ¸R : âŸ¨ projâ‚ Î” , (âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”) âŸ© âŠ¢â± âŸ¨ B , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ A âŠ¸ B , m âŸ©

    âŠ¸L : merge Î”â‚ Î”â‚‚ Î”â‚â‚‚ â†’ merge Î”â‚‚ Î”â‚ƒ Î”â‚‚â‚ƒ â†’ merge Î”â‚â‚‚ Î”â‚ƒ Î”
      â†’ mayConsume Î”â‚â‚‚ âŸ¨ A âŠ¸ B , m âŸ© Î”â‚â‚‚'
      â†’ mayConsume Î”â‚‚â‚ƒ âŸ¨ A âŠ¸ B , m âŸ© Î”â‚‚â‚ƒ'
      â†’ Î”â‚ â‰¥á¶œ m â†’ Î”â‚‚ â‰¥á¶œ m â†’ cContractable Î”â‚‚
      â†’ Î”â‚â‚‚ âŠ¢â± âŸ¨ A , m âŸ©
      â†’ âŸ¨ projâ‚ Î”â‚‚â‚ƒ , (âŸ¨ B , m âŸ© âˆ· projâ‚‚ Î”â‚‚â‚ƒ) âŸ© âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    ğŸ™R : cWeakenable Î”
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ ğŸ™ , m âŸ©

    ğŸ™L : mayConsume Î” âŸ¨ ğŸ™ , m âŸ© Î”' â†’ Î”' âŠ¢â± âŸ¨ C , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©

    â†“R : merge Î”â‚ Î”â‚‚ Î”
      â†’ Î”â‚ â‰¥á¶œ m 
      â†’ cWeakenable Î”â‚‚
      â†’ Î”â‚ âŠ¢â± âŸ¨ A , m âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ â†“[ m ][ k ] A , m âŸ©

    â†“L : mayConsume Î” âŸ¨ â†“[ m ][ k ] A , m âŸ© Î”'
      â†’ âŸ¨ projâ‚ Î”' , (âŸ¨ A , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , l âŸ©

    â†‘R : Î” âŠ¢â± âŸ¨ A , k âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ â†‘[ m ][ k ] A , k âŸ©

    â†‘L : mayConsume Î” âŸ¨ â†‘[ k ][ m ] A , k âŸ© Î”' â†’ k â‰¥ l
      â†’ âŸ¨ projâ‚ Î”' , (âŸ¨ A , k âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , l âŸ©
      ----------------------------------------------------------
      â†’ Î” âŠ¢â± âŸ¨ C , l âŸ©

    âŠ¤R : 
      -----------
      Î” âŠ¢â± âŸ¨ âŠ¤ , m âŸ©

    âˆ€L : mayConsume Î” âŸ¨ âˆ€[ A ] , m âŸ© Î”'
        â†’ isTerm Î” t
        â†’ âŸ¨ projâ‚ Î”' , (âŸ¨ (subst âˆ€[ A ] t) , m âŸ© âˆ· projâ‚‚ Î”') âŸ© âŠ¢â± âŸ¨ C , k âŸ©
        ----------------
        â†’ Î” âŠ¢â± âŸ¨ C , k âŸ©
